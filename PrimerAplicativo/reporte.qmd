---
title: "Informe Estadístico"
format: html
execute:
  echo: false
params:
  data_path: null
  var_cual_param: null  
  var_cuan1_param: null 
  var_cuan2_param: null 
  color_param: "blue"   
---

```{r}
#| include: false
library(tidyverse)
library(readxl)
library(kableExtra)
library(formattable)
datos <- readRDS(params$data_path)
```

## Informe sobre créditos aperturados en una entidad financiera

En las siguientes líneas se resume la información de las `r nrow(datos)` solicitudes de créditos aperturadas en las Coop. Paquito en el periodo entre `r min(datos$FECHAADJUDICACION)` y `r max(datos$FECHAADJUDICACION)`

### Créditos otorgados a nivel de provincia

```{r}
#| include: false
res01 <- datos %>% group_by(PROVINCIA_DOMICILIO) %>% summarise(Creditos = n(), Monto = mean(MONTO_OTORGADO)) %>% mutate(Porcentaje = round(100*Creditos/sum(Creditos),2)) %>% arrange(desc(Creditos))
```

Las tres provincias con mayor número de créditos son: `r res01$PROVINCIA_DOMICILIO[1]`, `r res01$PROVINCIA_DOMICILIO[2]` y `r res01$PROVINCIA_DOMICILIO[3]` con el `r paste0(res01$Porcentaje[1], "%")`, `r paste0(res01$Porcentaje[2], "%")` y `r paste0(res01$Porcentaje[3], "%")`, respectivamente.

Por otra parte, se comparte los montos promedio de créditos solicitados en cada provincia:

```{r}
#| echo: false
tb01 <- res01 %>% arrange(desc(Monto)) %>% select(PROVINCIA_DOMICILIO, Monto) %>% mutate(Monto = paste("$", round(Monto, 2)))
colnames(tb01) <- c("Provincia", "Monto")
tb01 %>% kable(caption = "Resumen de montos promedio de crédito por Provincia") %>% 
      kable_paper(full_width = F, font_size = 18) %>% 
      row_spec(0, bold = T, color = "white", background = "#1FA123") %>% 
      row_spec(1:3, bold = T, color = "white", background = "#224EC7")
```

```{r}
#| echo: false
# Buscar columna de profesión
profesion_col <- names(datos)[grep("PROFESION|profesion|Profesion", names(datos))][1]

# Crear resumen simple por profesión
if (!is.na(profesion_col)) {
  res_profesion <- datos %>%
    rename(Profesion = all_of(profesion_col)) %>%
    count(Profesion) %>%
    mutate(Porcentaje = round(100 * n / sum(n), 2)) %>%
    arrange(desc(n)) %>%
    rename(Creditos = n)
  
  top_profesiones <- head(res_profesion, 3)
}
```
### Créditos otorgados a nivel de profesión

`r if (!is.na(profesion_col)) { paste0("Las tres profesiones con más créditos son: ", top_profesiones$Profesion[1], " (", top_profesiones$Porcentaje[1], "%), ", top_profesiones$Profesion[2], " (", top_profesiones$Porcentaje[2], "%) y ", top_profesiones$Profesion[3], " (", top_profesiones$Porcentaje[3], "%).") } else { "No se encontró información de profesiones en los datos." }`

```{r}
#| echo: false
if (!is.na(profesion_col)) {
  res_profesion %>%
    head(10) %>%
    select(Profesion, Creditos, Porcentaje) %>%
    kable(caption = "Top 10 Profesiones con Más Créditos") %>% 
    kable_paper(full_width = FALSE, font_size = 14) %>% 
    row_spec(0, bold = TRUE, color = "white", background = "#132b60")
} else {
  data.frame(Información = "Datos de profesión no disponibles") %>%
    kable() %>% 
    kable_paper(full_width = FALSE, font_size = 14)
}

```
